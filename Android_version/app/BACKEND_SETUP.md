# Android App Backend Setup

## âœ… FIXED: Embedding Incompatibility Issue

The Android app was previously generating **fake embeddings** (color histograms) while the web app uses **real CLIP model embeddings**. This caused images uploaded from Android to be indexed but not searchable.

**Solution**: The Android app now calls the Flask backend directly for upload and search operations, ensuring all embeddings are generated using the same CLIP model.

---

## ğŸš€ How to Run

### Step 1: Start Flask Backend

Open a terminal in `webapp/512Gallery` and run:

```bash
# Install dependencies (first time only)
pip install -r requirements.txt

# Start Flask server
python app.py
```

The backend will start on `http://localhost:7860`

### Step 2: Configure Android App

1. Open `RetrofitClient.kt`
2. Update `BACKEND_BASE_URL`:
   - **For Android Emulator**: `http://10.0.2.2:7860/`
   - **For Real Device**: `http://YOUR_COMPUTER_IP:7860/` (e.g., `http://192.168.1.100:7860/`)

### Step 3: Find Your Computer's IP (For Real Device Only)

**Windows:**
```powershell
ipconfig
# Look for "IPv4 Address" under your active network adapter
```

**Example:** If your IP is `192.168.1.100`, set:
```kotlin
private const val BACKEND_BASE_URL = "http://192.168.1.100:7860/"
```

### Step 4: Build and Run Android App

Build the app in Android Studio and run on emulator or device.

---

## ğŸ”§ How It Works Now

### Upload Flow:
1. **Android** â†’ Selects image
2. **Android** â†’ Sends multipart image to Flask `/upload`
3. **Flask** â†’ Uploads to ImgBB
4. **Flask** â†’ Generates CLIP embedding (real model)
5. **Flask** â†’ Stores in Pinecone
6. **Flask** â†’ Returns success + image count
7. **Android** â†’ Updates UI

### Search Flow:
1. **Android** â†’ Sends text query to Flask `/search`
2. **Flask** â†’ Generates CLIP text embedding
3. **Flask** â†’ Queries Pinecone
4. **Flask** â†’ Returns best match
5. **Android** â†’ Displays result

---

## âœ¨ Benefits

âœ… **Cross-platform compatibility**: Images uploaded from Android can now be found from web (and vice versa)
âœ… **Real CLIP embeddings**: All embeddings generated by same model
âœ… **Stats work correctly**: Total image count updates properly
âœ… **Simpler Android code**: No need to manage ImgBB/Pinecone APIs client-side
âœ… **Better accuracy**: Proper semantic search instead of color histograms

---

## ğŸ› Troubleshooting

### "Failed to connect" error:
- âœ… Make sure Flask is running (`python app.py`)
- âœ… Check firewall allows port 7860
- âœ… For real device, ensure phone and computer are on same WiFi network
- âœ… Verify `BACKEND_BASE_URL` is correct

### "No images indexed" error:
- âœ… Upload an image first before searching
- âœ… Check Flask console for upload errors

### Images not searchable:
- âœ… This is now fixed! All embeddings use CLIP model

---

## ğŸ“ Notes

- The Flask backend **must be running** for the Android app to work
- Images uploaded before this fix (with fake embeddings) won't match properly - recommend deleting and re-uploading
- Both web and Android apps now share the same Pinecone index with compatible embeddings
